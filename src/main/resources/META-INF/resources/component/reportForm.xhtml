<!DOCTYPE html>
<ui:component xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:cc="http://java.sun.com/jsf/composite"
	xmlns:dbs="http://www.dbsoft.com.br/ui/dbsfaces" xmlns:dbscom="http://www.dbsoft.com.br/ui/dbsfacescom">
		
	<cc:interface componentType="br.com.dbsoft.ui.component.reportForm" >
		<cc:attribute name="reportBean" preferred="true"/>
		<cc:attribute name="caption"/>
		<cc:attribute name="filterDialogWidth" default="400"/>
		<cc:attribute name="filterDialogHeight" default="200"/>
		<cc:facet name="filter"/>
	</cc:interface>
 
	<cc:implementation>
		<div id="#{cc.clientId}" class="dbs_reportForm dbs_reportForm_#{cc.clientId}" >
			<dbs:div id="#{cc.id}_header" styleClass="-header">
				<div class="-caption dbs_not_selectable">
					<span class="-icon dbs_icon -i_relatorio"/>
					<span class="-content">
						#{cc.attrs.caption}
						#{cc.attrs.width}
					</span>
					<dbs:div styleClass="-toolbar" rendered="#{!cc.reportBean.showFilters}">
						<dbs:button label="#{cc.resourceBundleMap.filtros}" action="#{cc.reportBean.setShowFilters(true)}"  iconClass="dbs_icon -i_imprimir_filtro" update="#{cc.id}_header #{cc.id}_dialogs" execute="@this"/>
						<dbs:button label="#{cc.resourceBundleMap.imprimir}" rendered="#{cc.reportBean.isCreated}" onclick="document.getElementById('PDFtoPrint').contentWindow.print();" update="@none" iconClass="dbs_icon -i_imprimir"/>
						<dbs:menu rendered="#{cc.reportBean.isCreated}">
							<dbs:submenu label="#{cc.resourceBundleMap.exportar}" iconClass="dbs_icon -i_export">
								<dbs:menuitem action="#{cc.reportBean.savePDF()}" label="PDF - Adobe"/>
								<dbs:menuitem action="#{cc.reportBean.saveXLS()}" label="XLS - Excel"/>
								<dbs:menuitem action="#{cc.reportBean.saveXML()}" label="XML"/>
								<dbs:menuitem action="#{cc.reportBean.saveHTML()}" label="Html"/>
							</dbs:submenu>
						</dbs:menu>
					</dbs:div>
				</div>
 			</dbs:div>

			<dbs:div id="#{cc.id}_content" styleClass="-content dbs_back_texture_black_gradient">
				<script type="text/javascript">
					/* <![CDATA[ */
					$(document).ready(function() {
						var xReportFormId = "#" + dbsfaces.util.jsid('#{cc.clientId}');
						dbs_reportForm(xReportFormId);
					}); 
				/* ]]> */
				</script>		

				<c:if test="#{cc.reportBean.isCreated}">
					<script type="text/javascript">
					/* <![CDATA[ */
						dbsfaces.ui.showLoading("reportForm", true);
					/* ]]> */
					</script>
	
					<iframe id="PDFtoPrint" onload="dbsfaces.ui.showLoading('reportForm', false)" src="#{cc.reportBean.PDFFilePath}" width="100%" height="100%" />
				
					<script type="text/javascript">
					/* <![CDATA[ */
						dbsfaces.ui.showLoading("reportForm", false);
					/* ]]> */
					</script>
					
				</c:if>
			</dbs:div>
 			<dbs:div id="#{cc.id}_dialogs" styleClass="-dialog" >
				<c:if test="#{not empty cc.facets.filter}">  
					<dbs:dialog caption="Filtros"
								height="#{cc.attrs.filterDialogHeight}"
								width="#{cc.attrs.filterDialogWidth}"
								rendered="#{cc.reportBean.showFilters}">
						<f:facet name="toolbar">
							<dbs:ul>
								<dbs:li>
									<dbs:button iconClass="dbs_icon -i_imprimir_visualizar"  action="#{cc.reportBean.create()}" update="#{cc.id}_header #{cc.id}_dialogs #{cc.id}_content" execute="#{cc.clientId}"/> 
								</dbs:li>
								<dbs:li rendered="#{cc.reportBean.isCreated}">
									<dbs:button iconClass="dbs_icon -i_cancelar" action="#{cc.reportBean.setShowFilters(false)}" update="#{cc.id}_header #{cc.id}_dialogs" execute="@this"/>
								</dbs:li>
							</dbs:ul>
						</f:facet>
						<cc:renderFacet name="filter"/>
					</dbs:dialog>							
	 			</c:if>
	 			<dbscom:beanDialogMessages userBean="#{cc.reportBean}"
	 							        update="#{cc.id}_header #{cc.id}_dialogs #{cc.id}_content">
	 			</dbscom:beanDialogMessages>
			</dbs:div>			
		</div>

	</cc:implementation>
</ui:component>