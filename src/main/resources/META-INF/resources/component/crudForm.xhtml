
<ui:component xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:cc="http://java.sun.com/jsf/composite"
	xmlns:dbs="http://www.dbsoft.com.br/ui/dbsfaces"
	xmlns:dbscom="http://www.dbsoft.com.br/ui/dbsfacescom">
		
	<cc:interface componentType="br.com.dbsoft.ui.component.crudForm">
		<cc:attribute name="crudBean" preferred="true" required="true"/>
		<cc:attribute name="id" preferred="true"/>
		<cc:attribute name="style"/>
		<cc:attribute name="styleClass"/>
		<cc:attribute name="rendered" preferred="true"/>	
		<cc:attribute name="update" default=""/>
		<cc:attribute name="allowDelete" default="true"/>
		<cc:attribute name="allowUpdate" default="true"/>
		<cc:attribute name="width" default="100"/>
		<cc:attribute name="height" default="100"/>
		<cc:facet name="approveDialog"/>
		<cc:facet name="reproveDialog"/>
	</cc:interface>
	
	<cc:implementation >
		<div id="#{cc.clientId}" class="dbs_crudForm #{cc.attrs.styleClass}" style="#{cc.attrs.style}">
			<dbs:div id="content">
				<dbs:dialog id="dialog"
				            caption="#{cc.crudBean.dialogCaption}" 
							width="#{cc.attrs.width}" 
							height="#{cc.attrs.height}">
					<f:facet name="toolbar">
						<c:if test="#{cc.crudBean.isViewing}">
							<dbs:ul style="float:left;">
								<dbs:li>
									<dbs:button id="firstx" iconClass="dbs_icon -i_move_primeiro" rendered="#{cc.crudBean.isFirst}" styleClass="dbs_button -disabled" style="opacity:0.3;" readOnly="true"/>
									<dbs:button id="first" iconClass="dbs_icon -i_move_primeiro" rendered="#{!cc.crudBean.isFirst}" action="#{cc.crudBean.moveFirst()}" update=":dialog " execute="@this"/>
								</dbs:li>
								<dbs:li>
									<dbs:button id="previousx" iconClass="dbs_icon -i_move_anterior" rendered="#{cc.crudBean.isFirst}" styleClass="dbs_button -disabled" style="opacity:0.3;" readOnly="true"/>
									<dbs:button id="previous" iconClass="dbs_icon -i_move_anterior" rendered="#{!cc.crudBean.isFirst}" action="#{cc.crudBean.movePrevious()}" update=":dialog " execute="@this"/>
								</dbs:li>
								<dbs:li>
									<dbs:button id="nextx" iconClass="dbs_icon -i_move_proximo" rendered="#{cc.crudBean.isLast}" styleClass="dbs_button -disabled" style="opacity:0.3;" readOnly="true"/>
									<dbs:button id="next" iconClass="dbs_icon -i_move_proximo" rendered="#{!cc.crudBean.isLast}" action="#{cc.crudBean.moveNext()}" update=":dialog " execute="@this"/>
								</dbs:li>
								<dbs:li>
									<dbs:button id="lastx" iconClass="dbs_icon -i_move_ultimo" rendered="#{cc.crudBean.isLast}" styleClass="dbs_button -disabled" style="opacity:0.3;" readOnly="true"/>
									<dbs:button id="last" iconClass="dbs_icon -i_move_ultimo" rendered="#{!cc.crudBean.isLast}" action="#{cc.crudBean.moveLast()}" update=":dialog " execute="@this"/>
								</dbs:li>
							</dbs:ul>						
							<dbs:ul >
								<dbs:li rendered="#{cc.crudBean.allowCopy and cc.crudBean.allowInsert}">
									<dbs:button id="copy" iconClass="dbs_icon -i_copiar" action="#{cc.crudBean.copy()}" update=":dialog " execute="@this" tooltip="Copiar dados para memória"/>
								</dbs:li>
								<dbs:li rendered="#{cc.attrs.allowDelete and cc.crudBean.allowDelete}">
									<dbs:button id="delete" iconClass="dbs_icon -i_excluir" action="#{cc.crudBean.delete()}" update=":dialog " execute="@this" tooltip="Excluir"/>
								</dbs:li>
								<dbs:li rendered="#{cc.attrs.allowUpdate and cc.crudBean.allowUpdate}">
									<dbs:button id="edit" iconClass="dbs_icon -i_editar" action="#{cc.crudBean.update()}" update=":dialog" execute="@this" tooltip="Editar"/> 
								</dbs:li>
								<dbs:li>
<!-- Retinado update do cc.clientId								   -->								
<!-- 								<dbs:button id="close" iconClass="dbs_icon -i_cancelar" action="#{cc.crudBean.close()}" update=":dialog #{cc.clientId} #{cc.attrs.update}" execute="@this"/> -->
									<dbs:button id="close" iconClass="dbs_icon -i_cancelar" action="#{cc.crudBean.close()}" update=":dialog #{cc.attrs.update}" execute="@this" tooltip="Fechar"/>
								</dbs:li>
							</dbs:ul>
						</c:if>
						<c:if test="#{cc.crudBean.isUpdating}">
							<dbs:ul>
								<dbs:li styleClass="-icon">
									<dbs:img styleClass="dbs_icon -i_editar"/>
								</dbs:li>
								<dbs:li>
									<dbs:button id="ok" iconClass="dbs_icon -i_ok" action="#{cc.crudBean.confirmEditing()}" update=":dialog #{cc.attrs.update}" execute="#{cc.clientId}" tooltip="Confirmar"/>
								</dbs:li>
								<dbs:li>
									<dbs:button id="cancel" iconClass="dbs_icon -i_cancelar" action="#{cc.crudBean.ignoreEditing()}" update=":dialog" execute="#{cc.clientId}" tooltip="Ignorar"/>
								</dbs:li>
							</dbs:ul>
						</c:if>
						<c:if test="#{cc.crudBean.isInserting}">
							<dbs:ul>
								<dbs:li styleClass="-icon">
									<dbs:img styleClass="dbs_icon -i_inserir"/>
								</dbs:li>
								<dbs:li rendered="#{cc.crudBean.allowCopy and cc.crudBean.allowInsert}">
									<dbs:button id="paste" iconClass="dbs_icon -i_colar" action="#{cc.crudBean.paste()}" rendered="#{cc.crudBean.isCopied}" update=":dialog " execute="@this" tooltip="Colar dados em memória"/>
								</dbs:li>
								<dbs:li>
									<dbs:button id="ok" iconClass="dbs_icon -i_ok" action="#{cc.crudBean.confirmEditing()}" update=":dialog #{cc.attrs.update}" execute="#{cc.clientId}" tooltip="Confirmar"/>
								</dbs:li>
								<dbs:li>
<!-- Retinado update do cc.clientId								   -->
<!-- 									<dbs:button id="cancel" iconClass="dbs_icon -i_cancelar" action="#{cc.crudBean.ignoreEditing()}" update=":dialog #{cc.clientId} #{cc.attrs.update}" execute="#{cc.clientId}"/> -->
									<dbs:button id="cancel" iconClass="dbs_icon -i_cancelar" action="#{cc.crudBean.ignoreEditing()}" update=":dialog #{cc.attrs.update}" execute="#{cc.clientId}" tooltip="Ignorar"/>
								</dbs:li>
							</dbs:ul>
						</c:if>
						<c:if test="#{cc.crudBean.isDeleting}">
							<dbs:ul>
								<dbs:li styleClass="-icon">
									<dbs:img styleClass="dbs_icon -i_excluir"/>
								</dbs:li>
							</dbs:ul>
						</c:if>
					</f:facet>
					
					<cc:insertChildren/>
						
<!-- 					<c:if test="#{cc.crudBean.isApprovingOrReproving}"> -->
<!-- 						<cc:renderFacet name="approve"/> -->
<!-- 					</c:if> -->
					<f:facet name="dialogMessage">
						<dbscom:beanDialogMessages id="message"
												   userBean="#{cc.crudBean}"
		 							               update=":dialog">
		 				</dbscom:beanDialogMessages>
	
						
						<c:if test="#{!cc.crudBean.hasMessage}">
							<dbs:dialog id="confirm"
										rendered="#{cc.crudBean.isCommitting}"
										messageIcon="c"
										height="150" 
										width="200" 
										yesAction="#{cc.crudBean.endEditing(true)}"
										noAction="#{cc.crudBean.endEditing(false)}"
										update=":dialog #{cc.attrs.update}" >
										<ui:fragment rendered="#{cc.crudBean.isUpdating}">
											#{cc.crudBean.dialogConfirmationEditMessage}
										</ui:fragment>		
										<ui:fragment rendered="#{cc.crudBean.isInserting}">
											#{cc.crudBean.dialogConfirmationInsertMessage}
										</ui:fragment>		
										<ui:fragment rendered="#{cc.crudBean.isDeleting}">
											#{cc.crudBean.dialogConfirmationDeleteMessage}
										</ui:fragment>		
							</dbs:dialog>
							<dbs:dialog id="ignore" 
										rendered="#{cc.crudBean.isIgnoring}"
										messageIcon="g"
										height="150" 
										width="200" 
										yesAction="#{cc.crudBean.endEditing(true)}"
										noAction="#{cc.crudBean.endEditing(false)}"
										update=":dialog #{cc.crudBean.isInserting ? cc.attrs.update :''}">
								<ui:fragment rendered="#{cc.crudBean.isUpdating}">
									#{cc.crudBean.dialogIgnoreEditMessage}
								</ui:fragment>		
								<ui:fragment rendered="#{cc.crudBean.isInserting}">
									#{cc.crudBean.dialogIgnoreInsertMessage}
								</ui:fragment>		
								<ui:fragment rendered="#{cc.crudBean.isDeleting}">
									#{cc.crudBean.dialogIgnoreDeleteMessage}
								</ui:fragment>		
							</dbs:dialog>
						</c:if>
					</f:facet>
				</dbs:dialog>
			</dbs:div>
		</div>
	</cc:implementation>
</ui:component>